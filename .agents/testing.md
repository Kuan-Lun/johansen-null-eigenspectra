# Testing Guidelines

本文件為測試相關的 AI Agent 提供詳細指導。

## 測試策略

### 測試組織

- 為新功能編寫全面的測試
- 保持統計計算的測試覆蓋率
- 驗證特徵值計算的數值準確性
- 將測試放在 `tests/` 目錄中，而不是 `src/` 文件內聯
- 遵循現有的測試結構，使用模組特定的測試目錄

### 測試類型

#### 單元測試

- 測試單個函數和方法的正確性
- 驗證邊界條件和異常情況
- 確保數值計算的精度
- 測試錯誤處理邏輯

#### 整合測試

- 測試模組間的互動
- 驗證端到端的工作流程
- 測試資料流和狀態轉換
- 驗證並行操作的正確性

#### 效能測試

- 對計算密集型操作進行基準測試
- 驗證記憶體使用效率
- 測試大規模資料處理效能
- 確保演算法的時間複雜度符合預期

## 統計測試特殊要求

### 數值精度驗證

- 使用適當的浮點數比較容差
- 驗證矩陣運算的數值穩定性
- 測試特徵值分解的準確性
- 確保隨機數生成的統計特性

### 可重現性測試

- 使用固定種子進行確定性測試
- 驗證相同輸入產生相同輸出
- 測試隨機性和可重現性的平衡
- 確保跨平台的一致性

### 邊界條件測試

- 測試極小和極大的矩陣維度
- 驗證奇異矩陣的處理
- 測試數值溢位和下溢情況
- 驗證空資料和無效輸入的處理

## 測試實作規範

### 測試文件組織

```text
src/
├──tests/
   ├── mod.rs                      # 測試模組宣告
   ├── matrix_utils_test/          # 矩陣工具測試
   │   ├── mod.rs
   │   ├── dmatrix_cumsum_test.rs
   │   └── sum_of_outer_products_test.rs
   ├── data_storage/               # 資料儲存測試
   │   ├── mod.rs
   │   ├── simulation_test.rs
   │   └── integration/            # 整合測試
   └── johansen_models_test.rs     # Johansen 模型測試
```

### 測試命名規範

- 使用描述性的測試函數名
- 遵循 `test_function_condition_expected` 模式
- 使用英文命名測試函數
- 在測試註解中使用繁體中文解釋測試目的

### 斷言和驗證

- 使用合適的斷言巨集（`assert_eq!`, `assert_approx_eq!` 等）
- 提供有意義的斷言失敗訊息
- 驗證不僅僅是成功路徑，也要測試失敗情況
- 使用自訂斷言函數處理複雜驗證邏輯

## 測試資料管理

### 測試資料生成

- 使用確定性的測試資料生成器
- 建立具有已知統計特性的測試資料
- 使用多種資料分佈進行測試
- 包含真實世界的資料樣本

### 測試資料驗證

- 驗證生成的測試資料的品質
- 確保測試資料覆蓋各種場景
- 定期更新和維護測試資料集
- 文件化測試資料的來源和特性

## 持續整合要求

### 自動化測試

- 確保所有測試在 CI 環境中可執行
- 測試應該快速且可靠
- 避免依賴外部資源的測試
- 確保測試的隔離性和等冪性

### 測試報告

- 生成詳細的測試覆蓋率報告
- 記錄效能基準測試結果
- 追蹤測試失敗趨勢
- 提供清晰的測試結果解釋

## 特殊注意事項

### 並行測試

- 測試多執行緒程式碼的正確性
- 驗證執行緒安全性
- 測試資料競爭和死鎖情況
- 使用適當的同步原語進行測試

### 記憶體安全測試

- 驗證記憶體分配和釋放
- 測試大資料集的記憶體使用
- 確保沒有記憶體洩漏
- 使用工具檢測記憶體安全問題
